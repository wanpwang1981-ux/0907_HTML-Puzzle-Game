# 專案執行計畫：功能優化與 Bug 修復

### **階段一：分析與規劃**

**1. 任務理解 (My Understanding):**

*   **核心目標:** 進行三項主要更新，以提升遊戲體驗、客製化程度與修復錯誤。
    1.  **修復「懸停吸附」Bug:** 解決拼圖塊在高滑鼠速度下會「隨機黏上」不正確位置的問題，並加入目標格子高亮提示功能，使放置更容易。
    2.  **新增「自選拼圖板大小」功能:** 讓使用者可以動態調整拼圖板的寬度（提供 200px, 400px, 600px, 800px 四種選項），且此調整不影響右側控制面板。
    3.  **優化手機版面配置:** 在小螢幕（手機）上，將上方的控制區塊移至遊戲畫面的最頂部，拼圖板在其下方。
*   **架構與規範:** 我將繼續遵循通用的前端開發最佳實踐。

**2. 預計影響範圍 (Anticipated Impact):**

*   `PLAN.md`: 將會**新增**此檔案，用以記錄本次的執行計畫。
*   `index.html`: 將有**小幅修改**。需要在控制區塊加入一組用於選擇拼圖板大小的按鈕。
*   `style.css`: 將有**中等程度修改**。
    *   需要新增高亮提示目標格的 CSS class (例如 `.target-highlight`)。
    *   需要修改 `@media` 查詢中的規則，使用 `order` 屬性來調整手機版面上控制區和拼圖板的順序。
    *   需要調整 `#puzzle-section` 的樣式，使其寬度可以被 JavaScript 動態修改。
*   `script.js`: 將有**重大修改**。
    *   `handleCellHover` 的邏輯將被移除。
    *   將改為在 `mousemove` 事件中即時計算滑鼠下的格子索引，以更精確地判斷位置，解決「隨機黏上」的 bug。
    *   在 `pickupPiece` 時，增加高亮目標格的邏輯；在 `placePiece` 時，移除高亮。
    *   需要為新增的尺寸按鈕添加事件監聽器，並編寫動態修改 `#puzzle-board` 寬度的函式。
*   `README.md`: 需要更新「如何遊玩」部分，加入關於選擇拼圖板大小的說明。

**3. 潛在風險與副作用 (Potential Risks & Side Effects):**

*   **效能:** `mousemove` 事件處理需要保持高效，避免在即時計算座標時造成延遲。
*   **版面變動:** 動態調整拼圖板大小可能會影響頁面佈局。需要確保在尺寸切換時，相關元素（如拼圖塊大小）也能正確地重新計算和渲染。
*   **CSS `order` 屬性相容性:** `order` 屬性在極舊的瀏覽器上可能不被支援，但對於現代瀏覽器來說是安全的。

**4. 規範遵循聲明 (Adherence Statement):**

*   我將繼續遵循通用的開發規範，確保程式碼的清晰度、模組化和可維護性。所有新功能（如尺寸切換、高亮提示）都將被封裝在獨立的函式中。

**5. 逐步執行計畫 (Step-by-Step Execution Plan):**

1.  **【第 1 步】新增尺寸選擇器 UI:**
    *   在 `index.html` 中，於控制區塊加入四個用於選擇尺寸的按鈕。
2.  **【第 2 步】實現動態尺寸調整:**
    *   在 `script.js` 中，為尺寸按鈕添加事件監聽器。
    *   編寫一個函式，可以接收指定的寬度，並將其應用於 `#puzzle-section` 或 `#puzzle-board` 元素。
    *   確保在調整大小後，拼圖板的高度和拼圖塊的大小也能相應地重新計算。
3.  **【第 3 步】修復「隨機黏上」Bug 並新增高亮提示:**
    *   移除 `mouseover` 事件監聽器。
    *   在 `mousemove` 事件處理器中，加入從滑鼠座標計算目標格子索引的邏輯。
    *   在 `pickupPiece` 函式中，找到對應的目標格子並為其添加 `.target-highlight` class。
    *   在 `placePiece` 和 `swapPiece` 函式中，移除格子的 `.target-highlight` class。
    *   在 `style.css` 中，定義 `.target-highlight` 的樣式（例如，發光的 `box-shadow`）。
4.  **【第 4 步】調整手機版面順序:**
    *   在 `style.css` 的 `@media` 查詢中，使用 `order` 屬性調整 `#controls-section` 和 `#puzzle-section` 的顯示順序，讓控制區在上方。
5.  **【第 5 步】更新說明文件:**
    *   修改 `README.md`，加入關於如何選擇拼圖板尺寸的說明。
6.  **【第 6 步】最終審查與提交:**
    *   完成所有開發後，請求程式碼審查。
    *   審查通過後，提交所有變更，並將此 `PLAN.md` 也一併提交。
